# Form Rendering - Implementation Guide

**Component:** Form Rendering & Data Capture (Phase 2.2)
**Duration:** Weeks 7-8 (2 weeks)
**Priority:** CRITICAL - Core user interaction with system
**Dependencies:** Form Builder must be completed, Templates must exist

---

## Table of Contents

1. [Overview](#overview)
2. [UI Layout & Mockups](#ui-layout--mockups)
3. [User Journey](#user-journey)
4. [Component Breakdown](#component-breakdown)
5. [Data Flow](#data-flow)
6. [Step-by-Step Implementation Guide](#step-by-step-implementation-guide)
7. [Pre-fill Service](#pre-fill-service)
8. [Auto-Save Mechanism](#auto-save-mechanism)
9. [Validation Strategy](#validation-strategy)
10. [File Upload Handling](#file-upload-handling)
11. [Progress Tracking](#progress-tracking)
12. [Testing Checklist](#testing-checklist)

---

## Overview

### What is Form Rendering?

Form Rendering is the process of **dynamically generating HTML forms** from checklist templates and allowing factory ICT staff to fill them out. Think of it as taking the template blueprint created by admins and turning it into an interactive, validated form with auto-save and smart pre-filling.

### Key Features

โ **Dynamic generation** - Forms generated from database, not hardcoded HTML
โ **Smart pre-fill** - 74% of fields auto-filled from inventory data
โ **Auto-save drafts** - Saves every 30 seconds, can resume anytime
โ **Real-time validation** - Immediate feedback on invalid input
โ **Progress tracking** - Visual indicator showing completion percentage
โ **Section navigation** - Collapsible accordion sections
โ **File uploads** - Attach supporting documents
โ **Responsive design** - Works on desktop and tablet

### User Persona

**Primary User:** Peter Mwangi (ICT Support at Kambaa Factory)

**Goals:**
- Fill out "Factory Monthly Report" for October 2025
- Complete 33 questions with minimal manual typing
- Save progress and come back later
- Submit for regional manager approval
- Attach screenshots of network issues

**Pain Points:**
- Currently fills Excel sheets manually (45+ minutes)
- Must look up data from multiple sources
- Excel formulas sometimes break
- No way to save partial progress
- Often forgets to submit on time

---

## UI Layout & Mockups

### Overall Layout: Single Page with Sections

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ KTDA ICT Reporting System                    ๐ค Peter Mwangi (Kambaa Factory) โ
โ                                                                        [Logout] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โ Back to Dashboard                                                            โ
โ                                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ Factory Monthly Report - October 2025                                      โโ
โ โ Status: Draft โข Last saved: 2 minutes ago โ                               โโ
โ โ                                                                            โโ
โ โ Progress: โโโโโโโโโโโโโโโโ 52% Complete (17 of 33 questions)              โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ [Accordion Section - Expanded]                                             โโ
โ โ ๐ฆ Hardware Status                                                    [โผ]  โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโคโ
โ โ                                                                            โโ
โ โ Total number of computers: *                                               โโ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                โโ
โ โ โ 45                                     โ โ Pre-filled from inventory    โโ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                โโ
โ โ Count all desktop and laptop computers                                     โโ
โ โ                                                                            โโ
โ โ Operational computers: *                                                   โโ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                โโ
โ โ โ 43                                     โ โ Pre-filled from inventory    โโ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                โโ
โ โ                                                                            โโ
โ โ Computers under repair: *                                                  โโ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                โโ
โ โ โ 2                                      โ โ Pre-filled from inventory    โโ
โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                                โโ
โ โ                                                                            โโ
โ โ Any hardware failures this month?: *                                       โโ
โ โ โ Yes  โ No                                                                โโ
โ โ                                                                            โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ [Accordion Section - Collapsed]                                            โโ
โ โ ๐ฆ Software Licenses โข 6 questions โข 4 answered                      [โถ]  โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ [Accordion Section - Collapsed]                                            โโ
โ โ ๐ฆ Network Infrastructure โข 9 questions โข 0 answered                 [โถ]  โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                โ
โ (3 more collapsed sections...)                                                โ
โ                                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ                  [Save Draft]          [Submit for Approval]              โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                โ
โ Auto-saving... โณ / Saved โ                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### Key UI Elements

1. **Header** - User info, template name, status
2. **Progress Bar** - Visual completion percentage
3. **Accordion Sections** - Collapsible sections with question count
4. **Form Fields** - Different input types with pre-fill indicators
5. **Action Buttons** - Save draft and submit
6. **Auto-save Indicator** - Shows saving status

---

## User Journey

### Journey 1: First-Time Form Fill (From Start to Submit)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 1: Navigate to Checklist                  โ
โ Dashboard โ "Fill Monthly Report" button        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 2: Select Template                        โ
โ Dropdown shows: "Factory Monthly Report"        โ
โ User selects and clicks "Start"                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 3: System Creates Draft                   โ
โ INSERT ChecklistSubmission (Status=Draft)       โ
โ ChecklistService.CreateDraftSubmission()        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 4: Pre-fill Service Runs                  โ
โ For each question:                              โ
โ - Check if can be pre-filled                    โ
โ - Query hardware/software/ticket data           โ
โ - Insert ChecklistResponse with IsPreFilled=1   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 5: Form Loads with Pre-filled Values      โ
โ User sees: "17 questions pre-filled โ"         โ
โ Progress bar shows: 52% complete                โ
โ First section expanded automatically            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 6: User Reviews Pre-filled Values         โ
โ Scrolls through Hardware section                โ
โ Sees: Total computers = 45 โ (correct)         โ
โ No changes needed for hardware counts           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 7: User Fills Manual Fields               โ
โ Opens "General Comments" section                โ
โ Types in text area:                             โ
โ "Key achievements: Upgraded all PCs to Win 11"  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 8: Auto-save Triggers (30 seconds)        โ
โ JavaScript detects changes                      โ
โ AJAX POST to /Checklist/SaveDraft              โ
โ Updates ChecklistResponses                      โ
โ Shows "Saved โ" indicator                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 9: User Uploads File                      โ
โ Question: "Attach network diagram"              โ
โ Clicks "Choose File" โ Selects image            โ
โ File uploads to server                          โ
โ Thumbnail appears below input                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 10: User Closes Browser (Partial Fill)    โ
โ Work interrupted, closes browser                โ
โ Draft saved automatically (last auto-save)      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 11: User Returns Next Day                 โ
โ Logs back in โ Dashboard shows:                 โ
โ "Resume October report (52% complete)"          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 12: Resume Editing                        โ
โ Clicks "Resume" โ Form loads with saved data    โ
โ Scrolls to first incomplete section             โ
โ Progress bar still shows 52%                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 13: Complete Remaining Questions          โ
โ Fills last 16 questions                         โ
โ Progress bar updates: 100% โ                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 14: Click "Submit for Approval"           โ
โ Validation runs (client-side first)             โ
โ All required fields filled? โ                   โ
โ All values within ranges? โ                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 15: Server Validation                     โ
โ AJAX POST to /Checklist/Submit                 โ
โ Server validates all fields                     โ
โ Update Status: Draft โ Submitted               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 16: Notification Sent                     โ
โ Hangfire job: Send email to regional manager   โ
โ SignalR: Real-time notification to manager     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Step 17: Success Message                       โ
โ "โ Report submitted successfully!"             โ
โ "Your regional manager will review it."         โ
โ "You'll be notified when it's approved."        โ
โ [View Submission] [Back to Dashboard]          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Journey 2: Validation Error Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ User Fills Form but Misses Required Field      โ
โ Clicks "Submit for Approval"                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Client-Side Validation Runs (jQuery)           โ
โ Detects: "Network uptime %" is empty (required)โ
โ Prevents form submission                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Error Display                                   โ
โ โข Scrolls to first error                        โ
โ โข Highlights field in red                       โ
โ โข Shows error message below field               โ
โ โข Updates progress bar (98% - 1 question left)  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ User Enters Invalid Value                      โ
โ Types "150" for uptime (max is 100)            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Real-time Validation Triggers (onblur)         โ
โ Detects value > max                             โ
โ Shows inline error: "Must be between 0-100"    โ
โ Field border turns red                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ User Corrects Value                            โ
โ Changes to "98.5"                               โ
โ Error clears immediately                        โ
โ Field border turns green                        โ
โ Progress updates to 100%                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Successful Submission                           โ
โ All validations pass                            โ
โ Form submits to server                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## Component Breakdown

### Component 1: Template Selection Page

**URL:** `/Checklist/SelectTemplate`

**Layout:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Available Checklists                                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                โ
โ For period: [October 2025 โผ]                                  โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ Factory Monthly Report                                โ โ
โ โ Frequency: Monthly โข 33 questions โข ~20 mins             โ โ
โ โ                                                          โ โ
โ โ Status: Not started for October 2025                     โ โ
โ โ Due: November 5, 2025                                    โ โ
โ โ                                                          โ โ
โ โ                              [Start Checklist]           โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ Factory Daily Checklist                               โ โ
โ โ Frequency: Daily โข 12 questions โข ~5 mins                โ โ
โ โ                                                          โ โ
โ โ Status: โ Completed for Oct 30, 2025                    โ โ
โ โ Submitted: Today at 9:15 AM                              โ โ
โ โ                                                          โ โ
โ โ                         [View] [Fill for Today]          โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ ๐ Incident Report                                       โ โ
โ โ Frequency: Ad-hoc โข 15 questions โข ~10 mins              โ โ
โ โ                                                          โ โ
โ โ Status: Available when needed                            โ โ
โ โ                                                          โ โ
โ โ                              [Report Incident]           โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**Elements:**
- **Period selector** - Choose month/date
- **Template cards** - Shows available templates
- **Status indicators** - Not started, In progress, Completed
- **Due dates** - Deadline for submission
- **Action buttons** - Start, Resume, View

---

### Component 2: Form Header

**Layout:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Factory Monthly Report - October 2025                                         โ
โ Kambaa Factory                                                                 โ
โ                                                                                โ
โ Status: Draft โข Last saved: 2 minutes ago โ โข Saving... โณ                    โ
โ                                                                                โ
โ Progress: โโโโโโโโโโโโโโโโโโโโโโโโ 75% Complete (25 of 33 questions)          โ
โ                                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ โ โน๏ธ Tip: 17 questions have been pre-filled from inventory data.           โ โ
โ โ Please review and update if needed.                              [Dismiss]โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**Elements:**
- **Template name** and reporting period
- **Tenant name** (factory name)
- **Status badge** - Draft, Submitted, Approved, Rejected
- **Last saved timestamp** - Updates dynamically
- **Saving indicator** - Shows during auto-save
- **Progress bar** - Visual completion percentage with count
- **Info banner** - Tips and notifications (dismissible)

---

### Component 3: Section (Accordion) - Expanded State

**Layout:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [Accordion Header - Clickable]                                                 โ
โ ๐ฆ Hardware Status                                                        [โผ] โ
โ Computer and device inventory โข 5 of 7 questions answered                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                                                โ
โ 1. Total number of computers: *                                                โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                          โ
โ    โ 45                                           โ โ Pre-filled             โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                          โ
โ    Count all desktop and laptop computers                                     โ
โ                                                                                โ
โ 2. Operational computers: *                                                    โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                          โ
โ    โ 43                                           โ โ Pre-filled             โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                          โ
โ                                                                                โ
โ 3. Computers under repair: *                                                   โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                          โ
โ    โ 2                                            โ โ Pre-filled             โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                          โ
โ                                                                                โ
โ 4. Computers faulty (not repairable): *                                        โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                          โ
โ    โ 0                                            โ โ Pre-filled             โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                          โ
โ                                                                                โ
โ 5. Any hardware failures this month?: *                                        โ
โ    โ Yes  โ No                                                                โ
โ                                                                                โ
โ 6. If yes, describe hardware failures:                                         โ
โ    (Hidden - only shows if Q5 = Yes)                                          โ
โ                                                                                โ
โ 7. Any hardware procurement needed?:                                           โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ    โ [Empty - user needs to fill]                                         โ โ
โ    โ                                                                       โ โ
โ    โ                                                                       โ โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ    Describe hardware you need from Head Office (optional)                     โ
โ                                                                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**Elements:**
- **Section icon** - Visual identifier
- **Section name** - From template
- **Progress text** - "5 of 7 questions answered"
- **Collapse toggle** - [โผ] or [โถ]
- **Question numbers** - Sequential numbering
- **Field labels** - With asterisk (*) for required
- **Input fields** - Type depends on question
- **Pre-fill indicator** - Green checkmark
- **Help text** - Below input (grey)
- **Conditional fields** - Hidden until condition met

---

### Component 4: Section - Collapsed State

**Layout:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [Accordion Header - Clickable]                                                 โ
โ ๐ฆ Software Licenses                                                      [โถ] โ
โ Software installations and licensing โข 4 of 6 questions answered โข 2 pending   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**Elements:**
- **Section icon** and name
- **Expand toggle** - [โถ]
- **Progress summary** - Questions answered and pending
- **Visual indicator** - If all answered (green checkmark), if missing (orange warning)

---

### Component 5: Field Types - Rendered Examples

#### Number Field (Pre-filled)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Total number of computers: *                                                   โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                      โ
โ โ 45                                                   โ โ Pre-filled         โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                      โ
โ Count all desktop and laptop computers                                         โ
โ Range: 1-500 โข Pre-filled from Hardware Inventory                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### Number Field (Manual Entry)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Total support tickets received: *                                              โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ โ ___________                                              โ                  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ Count of all tickets logged this month                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### Number Field (With Validation Error)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Network uptime percentage: *                                                   โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ โ 150                                              โ๏ธ ERRORโ (red border)     โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ โ Value must be between 0 and 100                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### Text Field
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ EWS Version: *                                                                 โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ โ v3.2.1                                           โ Pre-filled               โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ Current version of Electronic Weighment Solution                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### Date Field
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Last backup date: *                                                            โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ โ 2025-10-28                 ๐                   โ Pre-filled               โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ Date of most recent backup                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### Boolean Field (Radio Buttons)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Any hardware failures this month?: *                                           โ
โ โ Yes  โ No                                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### Boolean Field (Checkbox)
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Backup successful?:                                                            โ
โ โ Yes, backup completed successfully                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### Dropdown Field
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ WAN Connection Type: *                                                         โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ โ Fiber Optic                                           โผ โ                  โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                  โ
โ โข Fiber Optic                                                                  โ
โ โข Microwave                                                                    โ
โ โข Hybrid Connection                                                            โ
โ โข Microwave-Viable on last mile Fibre                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### Text Area
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Key achievements this month:                                                   โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ Completed migration to Windows 11 for all admin PCs.                       โโ
โ โ Conducted user training sessions for new ERP version.                      โโ
โ โ Upgraded network switches in warehouse area.                               โโ
โ โ                                                                             โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Maximum 1000 characters โข 145 characters used                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

#### File Upload
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Attach network diagram: (optional)                                             โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ [Choose File] network_topology.png                                         โโ
โ โ                                                                             โโ
โ โ โโโโโโโโโโโโโโ                                                             โโ
โ โ โ  [Image]   โ network_topology.png (245 KB)                               โโ
โ โ โ  Preview   โ Uploaded: Oct 30, 2025 10:45 AM                            โโ
โ โ โโโโโโโโโโโโโโ [Remove]                                                    โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ Allowed: .jpg, .png, .pdf โข Max size: 5 MB                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

### Component 6: Conditional Field (Hidden Then Shown)

**Initial State (Q5 = No):**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 5. Any hardware failures this month?: *                                        โ
โ    โ Yes  โ No                                                                โ
โ                                                                                โ
โ (Question 6 is hidden because Q5 = No)                                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**After User Selects "Yes":**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 5. Any hardware failures this month?: *                                        โ
โ    โ Yes  โ No                                                                โ
โ                                                                                โ
โ 6. Describe hardware failures: *                                               โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ    โ [User must now fill this field]                                        โ โ
โ    โ                                                                         โ โ
โ    โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ    Required because failures were reported                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**JavaScript Logic:**
- Watch Q5 for changes
- If Q5 = Yes, show Q6 with slide-down animation
- If Q5 = No, hide Q6 with slide-up animation
- Update progress bar when field visibility changes

---

### Component 7: Form Actions Footer

**Layout:**
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ Before submitting:                                                         โโ
โ โ โข Ensure all required fields (*) are filled                                โโ
โ โ โข Review pre-filled values for accuracy                                    โโ
โ โ โข Attach supporting documents if needed                                    โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ          [Save Draft]                     [Submit for Approval]           โโ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                                โ
โ Auto-save enabled โข Last saved: Just now โ                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**Button States:**

**Save Draft Button:**
- Always enabled
- Saves current state (Status remains "Draft")
- Shows success message: "Draft saved โ"

**Submit for Approval Button:**
- Enabled only if โฅ90% complete
- If clicked when incomplete:
  - Shows warning: "Please complete 3 more required fields"
  - Scrolls to first incomplete field
  - Highlights incomplete sections
- If clicked when complete:
  - Runs validation
  - If passes: Submit (Status โ "Submitted")
  - If fails: Shows errors

---

### Component 8: Auto-save Indicator

**States:**

**Idle State:**
```
Auto-save enabled โข Last saved: 2 minutes ago โ
```

**Saving State:**
```
Saving... โณ
```

**Success State:**
```
Saved โ โข Just now
```

**Error State:**
```
โ๏ธ Auto-save failed โข Retry? [Click here]
```

---

## Data Flow

### Flow 1: Opening a Form (First Time)

```
User Action              Frontend Event           Backend Action              Database Changes
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Click "Start"        โ  GET /Checklist/         โ ChecklistController      โ (No DB change yet)
                        FillForm?templateId=1      .FillForm(templateId)

                                                    Create draft:
                                                    - ChecklistService
                                                      .CreateDraft()

                                                                            โ INSERT ChecklistSubmissions
                                                                              Status = 'Draft'
                                                                              SubmissionId = 123

                                                    Pre-fill service:
                                                    - PreFillService
                                                      .PreFillResponses()
                                                    - Queries hardware,
                                                      software, tickets

                                                                            โ INSERT ChecklistResponses (17 rows)
                                                                              For 17 pre-fillable questions
                                                                              IsPreFilled = 1

Form loads with     โ  Render view with:
pre-filled data        - Template sections
                       - Question items
                       - Pre-filled responses
                       - Progress: 52%
```

---

### Flow 2: User Typing (Auto-save)

```
User Action              Frontend Event           Backend Action              Database Changes
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Types in text field โ   input event              โ (No immediate call)
                        (debounced)

Stops typing for    โ   Timer triggers           โ AJAX POST                 โ UPDATE ChecklistResponses
30 seconds              /Checklist/SaveDraft       ChecklistController         SET TextValue = 'new text'
                        {                          .SaveDraft(dto)             WHERE SubmissionId=123
                          submissionId: 123,                                     AND ItemId=5
                          itemId: 5,
                          value: 'new text'
                        }

Success indicator   โ   Response: { success }    โ Return success
"Saved โ"               Show "Saved" message
```

---

### Flow 3: Conditional Field Logic

```
User Action              Frontend Event           Backend Action              Database Changes
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Selects "Yes"       โ   change event on Q5       โ (No backend call)
radio button
                        JavaScript checks:
                        - Is there conditional
                          logic for Q6?
                        - Condition: If Q5=Yes

Show Q6 field       โ   Show Q6 with animation   โ (No backend call)
                        (slide down)

                        Update required
                        validation on Q6

                        Update progress bar
                        (33 โ 34 total questions)
```

---

### Flow 4: Form Submission

```
User Action              Frontend Event           Backend Action              Database Changes
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Click "Submit"      โ   submit event             โ (Client validation first)

Client validation   โ   jQuery Validation        โ (No backend call)
runs                    - Check all required
                        - Check all ranges
                        - Check all patterns

If validation       โ   Prevent submission       โ (No backend call)
fails                   Scroll to first error
                        Highlight errors

If validation       โ   AJAX POST                โ ChecklistController       โ UPDATE ChecklistSubmissions
passes                  /Checklist/Submit          .Submit(submissionId)       SET Status = 'Submitted'
                        {                                                       SubmittedDate = NOW()
                          submissionId: 123                                     WHERE SubmissionId=123
                        }

                                                    Server validation:
                                                    - Re-check all rules
                                                    - Verify no missing
                                                      required fields

                                                    If passes:
                                                    - Update status
                                                    - Queue notification

                                                    Hangfire job:
                                                    - Email regional mgr

                                                    SignalR:
                                                    - Real-time notification

Success response    โ   Response: { success }    โ Return success

Redirect to         โ   Navigate to
success page            /Checklist/Success

Show success        โ   Render success view
message                 "โ Submitted!"
```

---

### Flow 5: File Upload

```
User Action              Frontend Event           Backend Action              Database Changes
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
Click "Choose       โ   file input click         โ (No backend call)
File"

Select file         โ   change event             โ (Validate file)
                        File selected:             - Check type (.jpg, .png)
                        network.png (245 KB)       - Check size (< 5 MB)

                        If valid:
                        Show preview
                        Show upload button

Click "Upload"      โ   FormData object          โ POST /Checklist/          โ Save file to:
                        AJAX multipart/form         UploadFile                 wwwroot/uploads/
                        data upload                                            checklist/123/
                                                                               network.png

                                                    Generate file URL

                                                                            โ UPDATE ChecklistResponses
                                                                              SET FileUrl = '/uploads...'
                                                                              WHERE SubmissionId=123
                                                                                AND ItemId=10

Success             โ   Response:                โ Return file metadata
                        {
                          url: '/uploads/...',
                          thumbnail: '...',
                          size: 245120
                        }

Display uploaded    โ   Show thumbnail
file                    Show filename
                        Show remove button
```

---

## Step-by-Step Implementation Guide

### Phase 1: Form Generation Service (Days 1-2)

**Step 1.1: Create FieldRendererService**
- Create service class
- Add RenderField() method with switch statement
- Implement 7 render methods (one per field type)
- Handle validation rules in HTML attributes
- Handle pre-fill indicators
- Add unit tests

**Step 1.2: Create SectionRendererService**
- Create service class
- Add RenderSection() method
- Generate accordion markup (Bootstrap)
- Handle collapsible sections
- Handle icons
- Add unit tests

**Step 1.3: Create FormRendererService**
- Create service class
- Add RenderForm() method
- Orchestrate sections and fields
- Generate complete form HTML
- Add form wrapper and action buttons
- Add unit tests

**Step 1.4: Test Rendering**
- Create test template with all 7 field types
- Render form
- Verify HTML structure
- Verify validation attributes
- Verify accessibility (labels, aria)

---

### Phase 2: Controller & View (Day 3)

**Step 2.1: Create ChecklistController**
- SelectTemplate() GET - show available templates
- FillForm() GET - render form for selected template
- SaveDraft() POST - auto-save responses
- Submit() POST - submit for approval
- Success() GET - show success message

**Step 2.2: Create FillForm View**
- Layout with form header
- Progress bar component
- Sections rendered from service
- Action buttons footer
- Auto-save indicator
- Include jQuery, jQuery Validation, custom JS

**Step 2.3: Create SelectTemplate View**
- List available templates
- Show status (not started, in progress, completed)
- Show due dates
- Action buttons (Start, Resume, View)

**Step 2.4: Create Success View**
- Success message
- Submission summary
- What happens next (approval workflow)
- Links (View submission, Back to dashboard)

---

### Phase 3: Pre-fill Service (Days 4-5)

**Step 3.1: Create PreFillService Class**
- Create service interface
- Create implementation class
- PreFillResponses() method (main entry point)
- GetPreFillValue() method (per question)

**Step 3.2: Implement Pre-fill Methods (16 total)**
- Hardware counts (4 methods)
- Software versions and licenses (4 methods)
- Network metrics (3 methods)
- Support tickets (3 methods)
- Financial data (2 methods)

**Step 3.3: Pattern Matching Logic**
- Implement ItemCode-based matching
- Implement SectionId-based matching
- Implement question text pattern matching
- Fallback to null if no match

**Step 3.4: Integration with Form Generation**
- Call PreFillService when creating draft
- Insert responses with IsPreFilled=true
- Track pre-fill source for debugging
- Add pre-fill accuracy metrics

**Step 3.5: Test Pre-fill Accuracy**
- Create test data (hardware, software, tickets)
- Generate form
- Verify pre-filled values
- Calculate accuracy percentage
- Target: โฅ90% accuracy

---

### Phase 4: Auto-save Implementation (Day 6)

**Step 4.1: Create auto-save.js**
- Initialize on page load
- Set 30-second interval
- Serialize form data on timer
- AJAX POST to SaveDraft endpoint
- Handle success/error responses
- Show saving indicator
- Debounce to prevent multiple saves

**Step 4.2: Create SaveDraft Endpoint**
- Accept submission ID and responses
- Validate submission exists
- Validate submission is Draft status
- Upsert ChecklistResponses (insert or update)
- Update ModifiedDate
- Return success/error

**Step 4.3: Handle Edge Cases**
- User closes browser during save
- Network disconnection
- Concurrent edits (optimistic locking)
- Save queue (if multiple changes)

**Step 4.4: Add Visual Feedback**
- "Saving..." indicator during AJAX
- "Saved โ" indicator on success
- "Auto-save failed" indicator on error
- Retry button for failed saves
- Last saved timestamp

---

### Phase 5: Client-side Validation (Day 7)

**Step 5.1: Initialize jQuery Validation**
- Load jQuery Validation plugin
- Configure validation rules from backend
- Add rules dynamically based on field type
- Set error message placement
- Customize error styling

**Step 5.2: Field Type Validation Rules**
- **Text:** required, minlength, maxlength, pattern
- **Number:** required, min, max, number, step
- **Date:** required, date, minDate, maxDate
- **Boolean:** required (must select)
- **Dropdown:** required (must select option)
- **TextArea:** required, maxlength
- **FileUpload:** required, accept, filesize

**Step 5.3: Real-time Validation**
- Validate on blur (user leaves field)
- Validate on change (dropdown, radio, checkbox)
- Show error immediately
- Clear error when corrected
- Update progress bar

**Step 5.4: Submit Validation**
- Validate all fields on submit
- Prevent submission if errors
- Scroll to first error
- Highlight error fields
- Show error count in banner

**Step 5.5: Custom Validation Rules**
- Cross-field validation (e.g., Operational + Repair = Total)
- Conditional required (e.g., required if another field = Yes)
- Custom patterns (e.g., version number format)
- Date range validation

---

### Phase 6: Server-side Validation (Day 8)

**Step 6.1: Create ValidationService**
- Create service interface
- Create implementation class
- ValidateSubmission() method
- ValidateResponse() method per field type

**Step 6.2: Implement Validation Logic**
- Parse ValidationRules JSON
- Check required fields
- Check min/max values
- Check string patterns (regex)
- Check date ranges
- Check file types and sizes

**Step 6.3: Integration with Submit Endpoint**
- Call ValidationService before status change
- Return detailed error messages
- Include field names and error types
- HTTP 400 Bad Request if validation fails

**Step 6.4: Handle Validation Errors**
- Frontend receives error array
- Display errors inline per field
- Scroll to first error
- Highlight error fields
- Show error summary banner

---

### Phase 7: Conditional Logic (Day 9)

**Step 7.1: Parse Conditional Logic JSON**
- Read ConditionalLogic from ChecklistItems
- Parse JSON to JavaScript object
- Build condition map (itemId โ conditions)

**Step 7.2: Implement Show/Hide Logic**
- Watch dependent fields for changes
- Evaluate conditions (equals, not equals, greater than, etc.)
- Show/hide conditional fields with animation
- Update required validation dynamically
- Update progress bar when visibility changes

**Step 7.3: Handle Nested Conditions**
- Support multiple conditions (AND logic)
- Support chained conditions (A shows B, B shows C)
- Prevent circular dependencies

**Step 7.4: Test Conditional Logic**
- Create test template with conditions
- Test show/hide animations
- Test validation changes
- Test progress bar updates

---

### Phase 8: Progress Tracking (Day 10)

**Step 8.1: Calculate Progress**
- Count total questions (including conditional)
- Count answered questions
- Calculate percentage
- Update progress bar width

**Step 8.2: Progress Bar Component**
- Visual bar (Bootstrap progress)
- Percentage text
- Question count text
- Color coding (red < 50%, yellow 50-90%, green >90%)

**Step 8.3: Real-time Updates**
- Update on field change
- Update on conditional field show/hide
- Update on auto-save
- Smooth animation

**Step 8.4: Section Progress**
- Show progress per section in header
- "5 of 7 questions answered"
- Visual indicator (checkmark or warning)

---

### Phase 9: File Upload (Day 11)

**Step 9.1: File Input Component**
- Styled file input (Bootstrap)
- File type restrictions (HTML accept attribute)
- File size restrictions (JavaScript check)
- Preview thumbnail (for images)
- Upload progress bar

**Step 9.2: Upload Endpoint**
- Accept multipart/form-data
- Validate file type
- Validate file size
- Generate unique filename
- Save to wwwroot/uploads/checklist/{submissionId}/
- Return file URL

**Step 9.3: Integration with Form**
- Store file URL in ChecklistResponses.FileUrl
- Display uploaded file thumbnail
- Allow file removal
- Delete file from server on removal

**Step 9.4: Multiple File Upload (Optional)**
- Allow multiple files per question
- Store as JSON array in FileUrl
- Display all uploaded files
- Remove individual files

---

### Phase 10: Form Submission (Day 12)

**Step 10.1: Submit Button Logic**
- Enable only if โฅ90% complete
- Show warning if incomplete
- Run client validation
- Confirm submission with modal
- Submit via AJAX

**Step 10.2: Submit Endpoint**
- Validate submission exists
- Validate submission is Draft status
- Run server-side validation
- If passes:
  - Update Status = 'Submitted'
  - Set SubmittedDate = NOW()
  - Queue notification job
- If fails:
  - Return validation errors

**Step 10.3: Notification Queue**
- Hangfire background job
- Email to regional manager
- Include submission summary
- Include link to review page
- SignalR real-time notification
- Update manager's dashboard badge

**Step 10.4: Success Page**
- Show success message
- Show submission summary
- Explain next steps (approval)
- Show expected approval timeline
- Links (View submission, Dashboard)

---

## Pre-fill Service

### Pre-fill Method Mapping

| Question Pattern | Pre-fill Method | Data Source | Query |
|------------------|----------------|-------------|-------|
| "Total computers" | CountComputers() | TenantHardware | COUNT(*) WHERE ItemType IN ('Laptop','Desktop') |
| "Operational computers" | CountByStatus() | TenantHardware | COUNT(*) WHERE Status='Operational' |
| "EWS Version" | GetSoftwareVersion() | TenantSoftwareInstallations | SELECT VersionNumber |
| "Windows licenses" | GetLicenseCount() | TenantSoftwareInstallations | SELECT LicenseCount |
| "Network uptime" | GetMetricValue() | TenantMetrics | SELECT NumericValue WHERE MetricCode='UPTIME' |
| "Last backup date" | GetLastBackupDate() | TenantMetrics | SELECT MAX(DateValue) |
| "Total tickets" | CountTickets() | Tickets | COUNT(*) WHERE ReportingMonth=@Month |
| "Resolved tickets" | CountResolvedTickets() | Tickets | COUNT(*) WHERE Status='Resolved' |
| "Internet provider" | GetLastMetricValue() | TenantMetrics | SELECT TextValue ORDER BY Period DESC |

### Pre-fill Algorithm

**Decision Tree:**
```
For each ChecklistItem:
    โ
1. Check ItemCode against known codes
   โโ If match โ Execute specific pre-fill method
    โ
2. Check SectionId to determine domain
   โโ Hardware section? โ Try hardware pre-fill methods
   โโ Software section? โ Try software pre-fill methods
   โโ Tickets section? โ Try ticket pre-fill methods
   โโ Other? โ Continue
    โ
3. Check question text patterns (NLP-lite)
   โโ Contains "total" + "computer"? โ CountComputers()
   โโ Contains "version"? โ GetSoftwareVersion()
   โโ Contains "license" + "count"? โ GetLicenseCount()
   โโ No match? โ Continue
    โ
4. Check DataType hints
   โโ Number + question contains "count"? โ Try counting
   โโ Date + question contains "last"? โ Try MAX(date)
   โโ No inference possible?
    โ
5. Return NULL (no pre-fill available)
```

---

## Auto-Save Mechanism

### Auto-save Flow

```
Page Load
    โ
Initialize auto-save
Set interval: 30 seconds
    โ
Timer tick (every 30 seconds)
    โ
Check if form data changed?
    โโ No changes โ Skip save
    โโ Changes detected
        โ
    Show "Saving..." indicator
        โ
    Serialize form data
    {
        submissionId: 123,
        responses: [
            {itemId: 1, value: 45},
            {itemId: 2, value: 43},
            ...
        ]
    }
        โ
    AJAX POST /Checklist/SaveDraft
        โ
    Backend processes save
    Upsert ChecklistResponses
        โ
    Success response
        โ
    Show "Saved โ" indicator
    Update "Last saved" timestamp
        โ
    Next timer tick (30 seconds later)
```

### Edge Cases

**Case 1: User closes browser before auto-save**
- Solution: Hook to window.beforeunload event
- Synchronous AJAX save (blocks page close briefly)
- Show warning: "Saving changes..."

**Case 2: Network disconnection**
- Solution: Save to browser localStorage
- Show indicator: "Working offline - will sync when reconnected"
- Retry save every 10 seconds
- Merge changes when reconnected

**Case 3: Concurrent edits (multiple tabs)**
- Solution: Use optimistic locking
- Include ModifiedDate in save request
- If ModifiedDate doesn't match, return error
- Show conflict resolution UI
- Let user choose: Keep my changes / Use server version

---

## Validation Strategy

### Two-Phase Validation

**Phase 1: Client-side (jQuery Validation)**
- Fast feedback (no server round-trip)
- Immediate error display
- Prevents unnecessary server calls
- Can be bypassed (not trusted)

**Phase 2: Server-side (ValidationService)**
- Authoritative validation
- Cannot be bypassed
- Handles complex business rules
- Returns detailed error messages

### Validation Rules Priority

**1. Required Check**
- Always first validation
- Error: "This field is required"

**2. Data Type Check**
- Number: Is numeric?
- Date: Is valid date?
- Error: "Please enter a valid [type]"

**3. Range Check**
- Min/Max for numbers
- MinDate/MaxDate for dates
- MinLength/MaxLength for strings
- Error: "Value must be between X and Y"

**4. Pattern Check**
- Regex validation
- Email format
- Phone format
- Version format
- Error: "Invalid format"

**5. Custom Rules**
- Cross-field validation
- Business rules
- Error: Custom message

---

## File Upload Handling

### File Upload Flow

```
User selects file
    โ
JavaScript validates:
- File type (.jpg, .png, .pdf)
- File size (< 5 MB)
    โ
If invalid โ Show error, abort
If valid โ Continue
    โ
Show preview (if image)
Show upload button
    โ
User clicks "Upload"
    โ
Create FormData object
Append file
Append submissionId
Append itemId
    โ
AJAX POST /Checklist/UploadFile
(multipart/form-data)
    โ
Backend receives file
Validates again (server-side)
    โ
Generate unique filename:
{submissionId}_{itemId}_{timestamp}.{ext}
Example: 123_10_1698765432.png
    โ
Save to disk:
wwwroot/uploads/checklist/123/
    โ
Update database:
UPDATE ChecklistResponses
SET FileUrl = '/uploads/checklist/123/...'
WHERE SubmissionId=123 AND ItemId=10
    โ
Return JSON:
{
    success: true,
    fileUrl: '/uploads/...',
    fileName: 'network.png',
    fileSize: 245120,
    thumbnail: '/uploads/...thumb.png'
}
    โ
Frontend displays:
- Thumbnail
- Filename
- File size
- Remove button
```

### File Removal Flow

```
User clicks "Remove"
    โ
Confirmation: "Remove this file?"
    โ
If confirmed:
    โ
AJAX POST /Checklist/RemoveFile
{
    submissionId: 123,
    itemId: 10
}
    โ
Backend:
- Get file path from database
- Delete file from disk
- Update database:
  UPDATE ChecklistResponses
  SET FileUrl = NULL
    โ
Frontend:
- Remove thumbnail
- Show file input again
```

---

## Progress Tracking

### Progress Calculation

```
Total Questions = Base Questions + Visible Conditional Questions

Answered Questions = Questions with non-empty responses

Progress Percentage = (Answered / Total) * 100

Example:
- Base questions: 30
- Conditional questions: 3 (currently visible)
- Total: 33
- Answered: 25
- Progress: (25/33) * 100 = 75.76% โ Display as "76%"
```

### Progress Bar States

**0-49% (Red)**
```
โโโโโโโโโโโโโโโโโโโโ 35% Complete (12 of 33 questions)
```

**50-89% (Yellow)**
```
โโโโโโโโโโโโโโโโโโโโ 65% Complete (22 of 33 questions)
```

**90-99% (Blue)**
```
โโโโโโโโโโโโโโโโโโโโ 95% Complete (32 of 33 questions)
```

**100% (Green)**
```
โโโโโโโโโโโโโโโโโโโโ 100% Complete (33 of 33 questions) โ
```

### Section Progress Indicator

**Not Started:**
```
๐ฆ Software Licenses โข 6 questions โข 0 answered  โญ
```

**In Progress:**
```
๐ฆ Software Licenses โข 6 questions โข 4 answered  ๐ต
```

**Complete:**
```
๐ฆ Software Licenses โข 6 questions โข 6 answered  โ
```

---

## Testing Checklist

### Unit Testing

- [ ] FieldRendererService renders all 7 field types correctly
- [ ] SectionRendererService generates accordion markup
- [ ] FormRendererService orchestrates sections and fields
- [ ] PreFillService returns correct values for 16 methods
- [ ] ValidationService validates all field types
- [ ] Auto-save serializes form data correctly
- [ ] Progress calculation is accurate

### Integration Testing

- [ ] Create draft โ Pre-fill runs โ Form loads with data
- [ ] User types โ Auto-save triggers โ Database updates
- [ ] User submits โ Validation passes โ Status changes to Submitted
- [ ] User submits incomplete โ Validation fails โ Errors shown
- [ ] Conditional field โ Show/hide works โ Progress updates
- [ ] File upload โ Saves to disk โ URL stored in database
- [ ] File remove โ Deletes from disk โ URL cleared from database

### UI Testing

- [ ] Form renders correctly on desktop (1920x1080)
- [ ] Form renders correctly on tablet (768x1024)
- [ ] Accordion sections expand/collapse smoothly
- [ ] Progress bar updates in real-time
- [ ] Validation errors display inline
- [ ] Pre-fill indicators show correctly
- [ ] Auto-save indicator updates
- [ ] File upload shows progress bar

### Browser Compatibility

- [ ] Chrome (latest)
- [ ] Edge (latest)
- [ ] Firefox (latest)
- [ ] Safari (if Mac available)

### Performance Testing

- [ ] Form with 50 questions loads in < 2 seconds
- [ ] Auto-save completes in < 500ms
- [ ] Pre-fill for 30 questions completes in < 3 seconds
- [ ] File upload (5MB) completes in < 10 seconds
- [ ] Progress bar animation is smooth (60fps)

### Accessibility Testing

- [ ] All fields have labels
- [ ] Required fields indicated with asterisk and aria-required
- [ ] Error messages associated with fields (aria-describedby)
- [ ] Keyboard navigation works (Tab, Enter, Space)
- [ ] Screen reader announces validation errors
- [ ] Color contrast meets WCAG AA standards

---

**Document Version:** 1.0
**Last Updated:** October 30, 2025
**Maintained By:** KTDA ICT Development Team
**Next Steps:** Proceed to [5_ApprovalWorkflow_Implementation.md](5_ApprovalWorkflow_Implementation.md)
