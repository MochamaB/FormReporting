@model FormReporting.Models.ViewModels.Identity.RoleEditViewModel

<div class="step-content">
    <!-- Info Alert -->
    <div class="row">
        <div class="col-md-12 mb-3">
            <div class="alert alert-info">
                <i class="ri-information-line me-2"></i>
                <strong>Assign Initial Users (Optional)</strong><br />
                Select users who should have this role. You can only see users within your scope.
                You can skip this step and assign users later.
            </div>
        </div>
    </div>

    <!-- Search Box -->
    <div class="mb-3">
        <div class="input-group">
            <span class="input-group-text">
                <i class="ri-search-line"></i>
            </span>
            <input type="text"
                   class="form-control"
                   id="bulkUserSearch_roleUsers"
                   placeholder="Search by name or employee number..." />
            <button type="button" class="btn btn-primary" id="searchUsersBtn_roleUsers">
                <i class="ri-search-line me-1"></i>Search
            </button>
            <button type="button" class="btn btn-secondary" id="clearSearchBtn_roleUsers" style="display: none;">
                <i class="ri-close-line"></i>
            </button>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex justify-content-end gap-2 mb-3">
        <button type="button" class="btn btn-sm btn-outline-primary" id="selectAllUsers_roleUsers">
            <i class="ri-checkbox-multiple-line me-1"></i>Select All
        </button>
        <button type="button" class="btn btn-sm btn-outline-secondary" id="deselectAllUsers_roleUsers">
            <i class="ri-checkbox-blank-line me-1"></i>Deselect All
        </button>
    </div>

    <!-- Loading State -->
    <div id="loadingUsers_roleUsers" class="text-center py-4" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <p class="text-muted mt-2">Loading users...</p>
    </div>

    <!-- Tenant-Grouped User List (Populated via AJAX) -->
    <div id="tenantGroupedUsers_roleUsers" class="tenant-user-list">
        @* Populated dynamically via external JS *@
    </div>

    <!-- Empty State -->
    <div id="emptyState_roleUsers" class="text-center py-4" style="display: none;">
        <i class="ri-user-search-line" style="font-size: 3rem; color: #ccc;"></i>
        <p class="text-muted mt-2">No users available in your scope. You may not have permission to view users, or there are no users in your accessible tenants.</p>
    </div>

    <!-- Selected Count Badge -->
    <div class="mt-3">
        <span class="badge bg-primary-subtle text-primary" id="selectedCount_roleUsers">
            <i class="ri-user-line me-1"></i>0 users selected
        </span>
    </div>
</div>

<style>
    .tenant-user-list {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #e9ecef;
        border-radius: 0.25rem;
    }

    .user-card {
        border: 1px solid #e9ecef;
        border-radius: 0.25rem;
        padding: 0.75rem;
        margin: 0.5rem;
        cursor: pointer;
        transition: all 0.2s;
        background-color: #fff;
    }

    .user-card:hover {
        border-color: var(--vz-primary);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .user-card.selected {
        border-color: var(--vz-primary);
        background-color: rgba(var(--vz-primary-rgb), 0.05);
    }

    .user-card .user-checkbox {
        width: 18px;
        height: 18px;
    }
</style>
