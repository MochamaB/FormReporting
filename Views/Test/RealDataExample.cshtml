@using FormReporting.Extensions
@using FormReporting.Models.ViewModels.Components

@{
    ViewData["Title"] = "Real Data Example";
    ViewData["Breadcrumbs"] = new List<(string Title, string? Url)>
    {
        ("Components", null),
        ("Real Data Example", null)
    };
}

<div class="row">
    <div class="col-12">
        <div class="page-title-box d-sm-flex align-items-center justify-content-between">
            <h4 class="mb-sm-0">KTDA System Statistics - Real Data Example</h4>
        </div>
    </div>
</div>

<!-- ========== SECTION 1: ORGANIZATIONAL STRUCTURE ========== -->
<div class="row">
    <div class="col-12">
        <h5 class="mb-3 mt-2"><i class="ri-building-line text-primary"></i> Section 1: Organizational Structure</h5>
    </div>
</div>

@{
    var orgConfig = new StatsRowConfig
    {
        Titles = new List<string> { "Total Regions", "Total Tenants", "Active Tenants", "Inactive Tenants" },
        Values = new List<string>
        {
            ViewBag.TotalRegions.ToString(),
            ViewBag.TotalTenants.ToString(),
            ViewBag.ActiveTenants.ToString(),
            ViewBag.InactiveTenants.ToString()
        },
        Icons = new List<string> { "ri-map-pin-line", "ri-building-line", "ri-checkbox-circle-line", "ri-close-circle-line" },
        ColorThemes = new List<string> { "primary", "success", "success", "danger" },
        CardType = CardType.TileBoxCard,
        LinkTexts = new List<string> { "View regions", "View all tenants", "View active", "View inactive" },
        LinkUrls = new List<string> { "/regions", "/tenants", "/tenants?status=active", "/tenants?status=inactive" },
        TrendPercentages = new List<string> { "0", "5.2", "3.1", "2.1" },
        TrendDirections = new List<TrendDirection>
        {
            TrendDirection.Neutral,
            TrendDirection.Up,
            TrendDirection.Up,
            TrendDirection.Down
        }
    };
    var orgCards = orgConfig.BuildStatsRow();
}

<div class="row">
    @foreach (var card in orgCards)
    {
        <partial name="~/Views/Shared/Components/StatisticCards/_TileBoxCard.cshtml" model="card" />
    }
</div>

<!-- ========== SECTION 2: IDENTITY & ACCESS MANAGEMENT ========== -->
<div class="row mt-4">
    <div class="col-12">
        <h5 class="mb-3"><i class="ri-shield-user-line text-primary"></i> Section 2: Identity & Access Management</h5>
    </div>
</div>

@{
    var iamConfig = new StatsRowConfig
    {
        Titles = new List<string> { "Total Users", "Active Users", "Total Roles", "Permissions" },
        Values = new List<string>
        {
            ViewBag.TotalUsers.ToString(),
            ViewBag.ActiveUsers.ToString(),
            ViewBag.TotalRoles.ToString(),
            ViewBag.TotalPermissions.ToString()
        },
        Icons = new List<string> { "ri-user-line", "ri-user-check-line", "ri-shield-user-line", "ri-lock-line" },
        ColorThemes = new List<string> { "info", "info", "info", "info" },
        CardType = CardType.StatisticsCard,
        BadgeValues = new List<string> { "12.5 %", "8.3 %", "0 %", "0 %" },
        BadgeColors = new List<string> { "success", "success", "secondary", "secondary" },
        ComparisonTexts = new List<string> { "vs. last month", "vs. last month", "no change", "no change" }
    };
    var iamCards = iamConfig.BuildStatsRow();
}

<div class="row">
    @foreach (var card in iamCards)
    {
        <partial name="~/Views/Shared/Components/StatisticCards/_StatisticsCard.cshtml" model="card" />
    }
</div>

<!-- ========== SECTION 3: FORM TEMPLATES ========== -->
<div class="row mt-4">
    <div class="col-12">
        <h5 class="mb-3"><i class="ri-file-list-line text-primary"></i> Section 4: Form Templates & Submissions</h5>
    </div>
</div>

@{
    var iconLeftConfig = new StatsRowConfig
    {
        Titles = new List<string> { "Form Templates", "Active Templates", "Total Submissions", "This Month" },
        Values = new List<string> { "45", "38", "1,245", "342" },
        Icons = new List<string> { "bx bx-file", "bx bx-file-check", "bx bx-files", "bx bx-calendar" },
        ColorThemes = new List<string> { "success", "warning", "danger", "info" },
        CardType = CardType.IconLeftCard,
        Subtitles = new List<string> { "Across all modules", "7 inactive templates", "Since system launch", "23% increase" },
        TrendPercentages = new List<string> { "8.5", "5.2", "156.3", "23.1" },
        TrendDirections = new List<TrendDirection>
        {
            TrendDirection.Up,
            TrendDirection.Up,
            TrendDirection.Up,
            TrendDirection.Up
        }
    };
    var iconLeftCards = iconLeftConfig.BuildStatsRow();
    iconLeftCards[0].HasBackgroundColor = true;
}

<div class="row">
    @foreach (var card in iconLeftCards)
    {
        <partial name="~/Views/Shared/Components/StatisticCards/_IconLeftCard.cshtml" model="card" />
    }
</div>

<!-- ========== SECTION 4: SYSTEM-WIDE METRICS ========== -->
<div class="row mt-4">
    <div class="col-12">
        <h5 class="mb-3"><i class="ri-dashboard-line text-primary"></i> Section 3: System-Wide Metrics (CRM Widget)</h5>
    </div>
</div>

@{
    var crmCards = new List<StatCardViewModel>
    {
        new StatCardViewModel
        {
            Title = "Total Metrics",
            Value = "124",
            Icon = "ri-dashboard-line",
            TrendPercentage = "15.2",
            TrendDirection = TrendDirection.Up
        },
        new StatCardViewModel
        {
            Title = "Auto-Calculated",
            Value = "87",
            Icon = "ri-calculator-line",
            TrendPercentage = "12.1",
            TrendDirection = TrendDirection.Up
        },
        new StatCardViewModel
        {
            Title = "Compliance Checks",
            Value = "23",
            Icon = "ri-checkbox-circle-line",
            TrendPercentage = "5.3",
            TrendDirection = TrendDirection.Up
        },
        new StatCardViewModel
        {
            Title = "Alerts This Week",
            Value = "8",
            Icon = "ri-alert-line",
            TrendPercentage = "2.1",
            TrendDirection = TrendDirection.Down
        }
    };
}

<div class="row">
    <partial name="~/Views/Shared/Components/StatisticCards/_CRMWidgetCard.cshtml" model="crmCards" />
</div>

<!-- ========== SUCCESS MESSAGE ========== -->
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-success alert-border-left alert-dismissible fade show" role="alert">
            <i class="ri-check-double-line me-3 align-middle fs-16"></i><strong>Success!</strong> All statistic cards are rendering correctly with simulated KTDA data.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary-subtle">
                <h5 class="card-title mb-0"><i class="ri-information-line"></i> Implementation Notes</h5>
            </div>
            <div class="card-body">
                <p><strong>Controller Code (ComponentTestController.cs):</strong></p>
                <pre class="bg-light p-3 rounded"><code>public IActionResult RealDataExample()
{
    // Simulate real data from database
    ViewBag.TotalTenants = 77;
    ViewBag.ActiveTenants = 69;
    ViewBag.InactiveTenants = 8;
    ViewBag.TotalRegions = 9;

    ViewBag.TotalUsers = 156;
    ViewBag.ActiveUsers = 142;
    ViewBag.TotalRoles = 12;
    ViewBag.TotalPermissions = 45;

    return View();
}</code></pre>

                <p class="mt-3"><strong>View Code (simplified):</strong></p>
                <pre class="bg-light p-3 rounded"><code>var config = new StatsRowConfig
{
    Titles = new List&lt;string&gt; { "Total Regions", "Total Tenants", "Active", "Inactive" },
    Values = new List&lt;string&gt; {
        ViewBag.TotalRegions.ToString(),
        ViewBag.TotalTenants.ToString(),
        ViewBag.ActiveTenants.ToString(),
        ViewBag.InactiveTenants.ToString()
    },
    Icons = new List&lt;string&gt; { "ri-map-pin-line", "ri-building-line", "ri-check-line", "ri-close-line" },
    CardType = CardType.TileBoxCard
}.WithTrends(...).WithLinks(...);

var cards = config.BuildStatsRow();</code></pre>

                <div class="mt-4">
                    <h6>Navigation:</h6>
                    <div class="hstack gap-2">
                        <a href="/ComponentTest/StatCards" class="btn btn-primary btn-sm"><i class="ri-eye-line"></i> View All Card Types</a>
                        <a href="/" class="btn btn-secondary btn-sm"><i class="ri-home-line"></i> Back to Dashboard</a>
                        <a href="/ComponentTest/StatCards#usage" class="btn btn-info btn-sm"><i class="ri-code-line"></i> View Usage Guide</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
