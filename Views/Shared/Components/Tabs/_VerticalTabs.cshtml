@using FormReporting.Models.ViewModels.Components

@{
    // Support both direct model and ViewData passing
    // This allows parent views to maintain their own model type while passing tabs via ViewData
    var tabsModel = Model as TabsViewModel ?? ViewData["TabsViewModel"] as TabsViewModel;

    if (tabsModel == null)
    {
        throw new InvalidOperationException("TabsViewModel must be provided either as Model or via ViewData['TabsViewModel']");
    }
}

<style>
    /* Subtle primary background for active vertical tabs */
    .nav-pills .nav-link.active {
        background-color: rgba(var(--vz-primary-rgb), 0.15) !important;
        color: var(--vz-primary) !important;
        border-left: 3px solid var(--vz-primary);
    }

    .nav-pills .nav-link {
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
    }

    .nav-pills .nav-link:hover:not(.active) {
        background-color: rgba(var(--vz-primary-rgb), 0.05);
    }
</style>

@*
    Vertical Tabs Partial View

    Layout: Tabs on left/right, content on right/left
    Style: Vertical Nav Pills
    Best for: Settings pages, User profiles, Configuration panels

    Features:
    - Vertical tab navigation with icons
    - Optional badges/counts
    - Optional descriptions
    - Pills or tabs style
    - Disabled state support

    NOTE: This partial contains ZERO logic - all values pre-computed in TabsExtensions

    Usage:
    1. Direct model: <partial name="_VerticalTabs.cshtml" model="tabs" />
    2. ViewData: ViewData["TabsViewModel"] = tabs; <partial name="_VerticalTabs.cshtml" />
       (Use option 2 when parent view needs to maintain its own model type)
*@

@if (tabsModel.WrapInCard)
{
    <div class="card @tabsModel.ContainerCssClass">
        @if (!string.IsNullOrEmpty(tabsModel.CardTitle))
        {
            <div class="card-header">
                <h5 class="card-title mb-0">@tabsModel.CardTitle</h5>
                @if (!string.IsNullOrEmpty(tabsModel.CardSubtitle))
                {
                    <p class="text-muted mb-0">@tabsModel.CardSubtitle</p>
                }
            </div>
        }
        <div class="card-body">
            <div class="row">
                @* Left Column: Vertical Tabs *@
                <div class="col-md-3" style="border-right: 2px solid #e9ecef;">
                    <div class="@tabsModel.NavClasses" id="@tabsModel.TabsId" role="tablist" aria-orientation="vertical">
                        @foreach (var tab in tabsModel.Tabs)
                        {
                            @if (tabsModel.NavigationMode == TabsNavigationMode.ServerSide)
                            {
                                @* Server-side navigation: Use regular href links *@
                                <a class="@tab.NavLinkClasses mb-2 d-flex align-items-center"
                                   href="@tab.Url"
                                   @(tab.IsDisabled ? "tabindex=\"-1\"" : "")>
                                    @if (!string.IsNullOrEmpty(tab.Icon))
                                    {
                                        <i class="@tab.Icon fs-18 me-2"></i>
                                    }
                                    <span class="flex-grow-1">
                                        @tab.Title
                                        @if (!string.IsNullOrEmpty(tab.Description))
                                        {
                                            <small class="text-muted d-block">@tab.Description</small>
                                        }
                                    </span>
                                    @if (!string.IsNullOrEmpty(tab.Badge))
                                    {
                                        <span class="@tab.BadgeClasses ms-auto">@tab.Badge</span>
                                    }
                                </a>
                            }
                            else
                            {
                                @* Client-side navigation: Use Bootstrap data-bs-toggle *@
                                <a class="@tab.NavLinkClasses mb-2 d-flex align-items-center"
                                   id="@(tab.TabId)-tab"
                                   data-bs-toggle="pill"
                                   href="@tab.Href"
                                   role="tab"
                                   aria-controls="@tab.TabId"
                                   aria-selected="@tab.AriaSelected"
                                   @(tab.IsDisabled ? "tabindex=\"-1\"" : "")>
                                    @if (!string.IsNullOrEmpty(tab.Icon))
                                    {
                                        <i class="@tab.Icon fs-18 me-2"></i>
                                    }
                                    <span class="flex-grow-1">
                                        @tab.Title
                                        @if (!string.IsNullOrEmpty(tab.Description))
                                        {
                                            <small class="text-muted d-block">@tab.Description</small>
                                        }
                                    </span>
                                    @if (!string.IsNullOrEmpty(tab.Badge))
                                    {
                                        <span class="@tab.BadgeClasses ms-auto">@tab.Badge</span>
                                    }
                                </a>
                            }
                        }
                    </div>
                </div>

                @* Right Column: Tab Content (only for ClientSide mode) *@
                @if (tabsModel.NavigationMode == TabsNavigationMode.ClientSide)
                {
                    <div class="col-md-9">
                        <div class="@tabsModel.TabContentClasses mt-4 mt-md-0" id="@(tabsModel.TabsId)Content">
                            @foreach (var tab in tabsModel.Tabs)
                            {
                                <div class="@tab.TabPaneClasses"
                                     id="@tab.TabId"
                                     role="tabpanel"
                                     aria-labelledby="@(tab.TabId)-tab">
                                    @if (!string.IsNullOrEmpty(tab.ContentPartialPath))
                                    {
                                        @* Pass the parent view's model to the partial *@
                                        var parentModel = ViewData["ParentModel"];
                                        <partial name="@tab.ContentPartialPath" model="parentModel" />
                                    }
                                    else if (!string.IsNullOrEmpty(tab.ContentHtml))
                                    {
                                        @Html.Raw(tab.ContentHtml)
                                    }
                                    else
                                    {
                                        <p class="text-muted">No content provided for this tab.</p>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                }
                else
                {
                    @* Server-side mode: Content is provided by the page *@
                    <div class="col-md-9">
                        @if (ViewData["ServerSideContentPartial"] != null)
                        {
                            @* Render a partial view with the parent model *@
                            var contentPartialPath = ViewData["ServerSideContentPartial"]?.ToString();
                            var parentModel = ViewData["ParentModel"];
                            @await Html.PartialAsync(contentPartialPath, parentModel)
                        }
                        else if (ViewData["TabContent"] != null)
                        {
                            @Html.Raw(ViewData["TabContent"])
                        }
                        else
                        {
                            <p class="text-muted">No content provided for server-side navigation.</p>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
}
else
{
    <div class="@tabsModel.ContainerCssClass">
        <div class="row">
            @* Left Column: Vertical Tabs *@
            <div class="col-md-3">
                <div class="@tabsModel.NavClasses" id="@tabsModel.TabsId" role="tablist" aria-orientation="vertical">
                    @foreach (var tab in tabsModel.Tabs)
                    {
                        @if (tabsModel.NavigationMode == TabsNavigationMode.ServerSide)
                        {
                            @* Server-side navigation: Use regular href links *@
                            <a class="@tab.NavLinkClasses mb-2 d-flex align-items-center"
                               href="@tab.Url"
                               @(tab.IsDisabled ? "tabindex=\"-1\"" : "")>
                                @if (!string.IsNullOrEmpty(tab.Icon))
                                {
                                    <i class="@tab.Icon fs-18 me-2"></i>
                                }
                                <span class="flex-grow-1">
                                    @tab.Title
                                    @if (!string.IsNullOrEmpty(tab.Description))
                                    {
                                        <small class="text-muted d-block">@tab.Description</small>
                                    }
                                </span>
                                @if (!string.IsNullOrEmpty(tab.Badge))
                                {
                                    <span class="@tab.BadgeClasses ms-auto">@tab.Badge</span>
                                }
                            </a>
                        }
                        else
                        {
                            @* Client-side navigation: Use Bootstrap data-bs-toggle *@
                            <a class="@tab.NavLinkClasses mb-2 d-flex align-items-center"
                               id="@(tab.TabId)-tab"
                               data-bs-toggle="pill"
                               href="@tab.Href"
                               role="tab"
                               aria-controls="@tab.TabId"
                               aria-selected="@tab.AriaSelected"
                               @(tab.IsDisabled ? "tabindex=\"-1\"" : "")>
                                @if (!string.IsNullOrEmpty(tab.Icon))
                                {
                                    <i class="@tab.Icon fs-18 me-2"></i>
                                }
                                <span class="flex-grow-1">
                                    @tab.Title
                                    @if (!string.IsNullOrEmpty(tab.Description))
                                    {
                                        <small class="text-muted d-block">@tab.Description</small>
                                    }
                                </span>
                                @if (!string.IsNullOrEmpty(tab.Badge))
                                {
                                    <span class="@tab.BadgeClasses ms-auto">@tab.Badge</span>
                                }
                            </a>
                        }
                    }
                </div>
            </div>

            @* Right Column: Tab Content (only for ClientSide mode) *@
            @if (tabsModel.NavigationMode == TabsNavigationMode.ClientSide)
            {
                <div class="col-md-9">
                    <div class="@tabsModel.TabContentClasses mt-4 mt-md-0" id="@(tabsModel.TabsId)Content">
                        @foreach (var tab in tabsModel.Tabs)
                        {
                            <div class="@tab.TabPaneClasses"
                                 id="@tab.TabId"
                                 role="tabpanel"
                                 aria-labelledby="@(tab.TabId)-tab">
                                @if (!string.IsNullOrEmpty(tab.ContentPartialPath))
                                {
                                    @* Pass the parent view's model to the partial *@
                                    var parentModel = ViewData["ParentModel"];
                                    <partial name="@tab.ContentPartialPath" model="parentModel" />
                                }
                                else if (!string.IsNullOrEmpty(tab.ContentHtml))
                                {
                                    @Html.Raw(tab.ContentHtml)
                                }
                                else
                                {
                                    <p class="text-muted">No content provided for this tab.</p>
                                }
                            </div>
                        }
                    </div>
                </div>
            }
            else
            {
                @* Server-side mode: Content is provided by the page *@
                <div class="col-md-9">
                    @if (ViewData["ServerSideContentPartial"] != null)
                    {
                        @* Render a partial view with the parent model *@
                        var contentPartialPath = ViewData["ServerSideContentPartial"]?.ToString();
                        var parentModel = ViewData["ParentModel"];
                        @await Html.PartialAsync(contentPartialPath, parentModel)
                    }
                    else if (ViewData["TabContent"] != null)
                    {
                        @Html.Raw(ViewData["TabContent"])
                    }
                    else
                    {
                        <p class="text-muted">No content provided for server-side navigation.</p>
                    }
                </div>
            }
        </div>
    </div>
}
