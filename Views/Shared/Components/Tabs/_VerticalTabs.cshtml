@using FormReporting.Models.ViewModels.Components

@{
    // Support both direct model and ViewData passing
    // This allows parent views to maintain their own model type while passing tabs via ViewData
    var tabsModel = Model as TabsViewModel ?? ViewData["TabsViewModel"] as TabsViewModel;

    if (tabsModel == null)
    {
        throw new InvalidOperationException("TabsViewModel must be provided either as Model or via ViewData['TabsViewModel']");
    }
}

@*
    Vertical Tabs Partial View

    Layout: Tabs on left/right, content on right/left
    Style: Vertical Nav Pills
    Best for: Settings pages, User profiles, Configuration panels

    Features:
    - Vertical tab navigation with icons
    - Optional badges/counts
    - Optional descriptions
    - Pills or tabs style
    - Disabled state support

    NOTE: This partial contains ZERO logic - all values pre-computed in TabsExtensions

    Usage:
    1. Direct model: <partial name="_VerticalTabs.cshtml" model="tabs" />
    2. ViewData: ViewData["TabsViewModel"] = tabs; <partial name="_VerticalTabs.cshtml" />
       (Use option 2 when parent view needs to maintain its own model type)
*@

@if (tabsModel.WrapInCard)
{
    <div class="card @tabsModel.ContainerCssClass">
        @if (!string.IsNullOrEmpty(tabsModel.CardTitle))
        {
            <div class="card-header">
                <h5 class="card-title mb-0">@tabsModel.CardTitle</h5>
                @if (!string.IsNullOrEmpty(tabsModel.CardSubtitle))
                {
                    <p class="text-muted mb-0">@tabsModel.CardSubtitle</p>
                }
            </div>
        }
        <div class="card-body">
            <div class="row">
                @* Left Column: Vertical Tabs *@
                <div class="col-md-3">
                    <div class="@tabsModel.NavClasses" id="@tabsModel.TabsId" role="tablist" aria-orientation="vertical">
                        @foreach (var tab in tabsModel.Tabs)
                        {
                            <a class="@tab.NavLinkClasses mb-2"
                               id="@(tab.TabId)-tab"
                               data-bs-toggle="pill"
                               href="@tab.Href"
                               role="tab"
                               aria-controls="@tab.TabId"
                               aria-selected="@tab.AriaSelected"
                               @(tab.IsDisabled ? "tabindex=\"-1\"" : "")>
                                @if (!string.IsNullOrEmpty(tab.Icon))
                                {
                                    <i class="@tab.Icon d-block fs-20 mb-1"></i>
                                }
                                <span class="d-block">@tab.Title</span>
                                @if (!string.IsNullOrEmpty(tab.Badge))
                                {
                                    <span class="@tab.BadgeClasses">@tab.Badge</span>
                                }
                                @if (!string.IsNullOrEmpty(tab.Description))
                                {
                                    <small class="text-muted d-block mt-1">@tab.Description</small>
                                }
                            </a>
                        }
                    </div>
                </div>

                @* Right Column: Tab Content *@
                <div class="col-md-9">
                    <div class="@tabsModel.TabContentClasses mt-4 mt-md-0" id="@(tabsModel.TabsId)Content">
                        @foreach (var tab in tabsModel.Tabs)
                        {
                            <div class="@tab.TabPaneClasses"
                                 id="@tab.TabId"
                                 role="tabpanel"
                                 aria-labelledby="@(tab.TabId)-tab">
                                @if (!string.IsNullOrEmpty(tab.ContentPartialPath))
                                {
                                    @* Pass the parent view's model to the partial *@
                                    var parentModel = ViewData["ParentModel"];
                                    <partial name="@tab.ContentPartialPath" model="parentModel" />
                                }
                                else if (!string.IsNullOrEmpty(tab.ContentHtml))
                                {
                                    @Html.Raw(tab.ContentHtml)
                                }
                                else
                                {
                                    <p class="text-muted">No content provided for this tab.</p>
                                }
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="@tabsModel.ContainerCssClass">
        <div class="row">
            @* Left Column: Vertical Tabs *@
            <div class="col-md-3">
                <div class="@tabsModel.NavClasses" id="@tabsModel.TabsId" role="tablist" aria-orientation="vertical">
                    @foreach (var tab in tabsModel.Tabs)
                    {
                        <a class="@tab.NavLinkClasses mb-2"
                           id="@(tab.TabId)-tab"
                           data-bs-toggle="pill"
                           href="@tab.Href"
                           role="tab"
                           aria-controls="@tab.TabId"
                           aria-selected="@tab.AriaSelected"
                           @(tab.IsDisabled ? "tabindex=\"-1\"" : "")>
                            @if (!string.IsNullOrEmpty(tab.Icon))
                            {
                                <i class="@tab.Icon d-block fs-20 mb-1"></i>
                            }
                            <span class="d-block">@tab.Title</span>
                            @if (!string.IsNullOrEmpty(tab.Badge))
                            {
                                <span class="@tab.BadgeClasses">@tab.Badge</span>
                            }
                            @if (!string.IsNullOrEmpty(tab.Description))
                            {
                                <small class="text-muted d-block mt-1">@tab.Description</small>
                            }
                        </a>
                    }
                </div>
            </div>

            @* Right Column: Tab Content *@
            <div class="col-md-9">
                <div class="@tabsModel.TabContentClasses mt-4 mt-md-0" id="@(tabsModel.TabsId)Content">
                    @foreach (var tab in tabsModel.Tabs)
                    {
                        <div class="@tab.TabPaneClasses"
                             id="@tab.TabId"
                             role="tabpanel"
                             aria-labelledby="@(tab.TabId)-tab">
                            @if (!string.IsNullOrEmpty(tab.ContentPartialPath))
                            {
                                @* Pass the parent view's model to the partial *@
                                var parentModel = ViewData["ParentModel"];
                                <partial name="@tab.ContentPartialPath" model="parentModel" />
                            }
                            else if (!string.IsNullOrEmpty(tab.ContentHtml))
                            {
                                @Html.Raw(tab.ContentHtml)
                            }
                            else
                            {
                                <p class="text-muted">No content provided for this tab.</p>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
}
