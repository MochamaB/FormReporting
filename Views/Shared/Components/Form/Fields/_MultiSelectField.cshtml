@model FormReporting.Models.ViewModels.Components.FormFieldViewModel

@*
    MultiSelect Field - Multi-select dropdown
*@

<div class="mb-3 col-md-@Model.ColumnWidth">
    <label for="@Model.InputId" class="form-label">
        @Model.FieldName
        @if (Model.IsRequired)
        {
            <span class="text-danger">*</span>
        }
    </label>

    <select class="form-select"
            id="@Model.InputId"
            name="@Model.InputName"
            multiple
            @(Model.IsRequired ? "required" : "")
            @(Model.IsDisabled ? "disabled" : "")
            data-field-id="@Model.FieldId"
            @if (!string.IsNullOrEmpty(Model.ValidationDataAttribute))
            {
                <text>data-validation='@Model.ValidationDataAttribute'</text>
            }
            @if (!string.IsNullOrEmpty(Model.ConditionalLogicDataAttribute))
            {
                <text>data-conditional='@Model.ConditionalLogicDataAttribute'</text>
            }>
        @if (Model.Options != null && Model.Options.Any())
        {
            var currentValueStr = Model.CurrentValue?.ToString() ?? string.Empty;
            var selectedValues = !string.IsNullOrEmpty(currentValueStr)
                ? currentValueStr.Split(',')
                : Array.Empty<string>();

            foreach (var option in Model.Options)
            {
                       <option value="@option.Value" selected="@(option.Value == currentValueStr)">
                            @option.Label
                        </option>

            }
        }
    </select>

    @if (!string.IsNullOrEmpty(Model.HelpText))
    {
        <div class="form-text">@Model.HelpText</div>
    }

    <div class="invalid-feedback"></div>
</div>
