@model FormReporting.Models.ViewModels.Components.FormFieldViewModel

@*
    Checkbox Field - Single checkbox or checkbox group
*@

<div class="mb-3 col-md-@Model.ColumnWidth">
    <label class="form-label mb-3" style="word-wrap: break-word; overflow-wrap: break-word;">
        @if (Model.ShowFieldNumber)
        {
            <span class="text-primary me-2">@Model.DisplayOrder.</span>
        }
        @Model.FieldName
        @if (Model.IsRequired)
        {
            <span class="text-danger">*</span>
        }
    </label>

    @if (Model.Options != null && Model.Options.Any())
    {
        @* Multiple checkboxes *@
        var currentValueStr = Model.CurrentValue?.ToString() ?? string.Empty;
        var hasCurrentValue = !string.IsNullOrEmpty(currentValueStr);
        var currentValues = hasCurrentValue ? currentValueStr.Split(',') : Array.Empty<string>();
        
        <div class="checkbox-group" data-field-id="@Model.FieldId">
            @foreach (var option in Model.Options)
            {
                // Use CurrentValue if set, otherwise fall back to IsSelected (default from database)
                var isChecked = hasCurrentValue ? currentValues.Contains(option.Value) : option.IsSelected;

                <div class="form-check">
                    <input type="checkbox"
                           class="form-check-input"
                           id="@(Model.InputId)_@option.Value"
                           name="@Model.InputName"
                           value="@option.Value"
                           data-field-id="@Model.FieldId"
                           @(isChecked ? "checked" : "")
                           @(Model.IsDisabled ? "disabled" : "")
                           @if (!string.IsNullOrEmpty(Model.ValidationDataAttribute))
                           {
                               <text>data-validation='@Model.ValidationDataAttribute'</text>
                           }
                           @if (!string.IsNullOrEmpty(Model.ConditionalLogicDataAttribute))
                           {
                               <text>data-conditional='@Model.ConditionalLogicDataAttribute'</text>
                           } />
                    <label class="form-check-label" for="@(Model.InputId)_@option.Value">
                        @option.Label
                    </label>
                </div>
            }
        </div>
    }
    else
    {
        @* Single checkbox *@
        <div class="form-check">
            <input type="checkbox"
                   class="form-check-input"
                   id="@Model.InputId"
                   name="@Model.InputName"
                   value="true"
                   @(Model.CurrentValue?.ToString() == "true" ? "checked" : "")
                   @(Model.IsRequired ? "required" : "")
                   @(Model.IsDisabled ? "disabled" : "")
                   data-field-id="@Model.FieldId"
                   @if (!string.IsNullOrEmpty(Model.ValidationDataAttribute))
                   {
                       <text>data-validation='@Model.ValidationDataAttribute'</text>
                   }
                   @if (!string.IsNullOrEmpty(Model.ConditionalLogicDataAttribute))
                   {
                       <text>data-conditional='@Model.ConditionalLogicDataAttribute'</text>
                   } />
            <label class="form-check-label" for="@Model.InputId">
                @Model.PlaceholderText
            </label>
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.HelpText))
    {
        <div class="form-text">@Model.HelpText</div>
    }

    <div class="invalid-feedback"></div>
</div>
