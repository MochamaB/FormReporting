@model FormReporting.Models.ViewModels.Forms.FormBuilderViewModel
@using FormReporting.Models.ViewModels.Components
@using FormReporting.Extensions
@{
    Layout = "~/Views/Shared/_BuilderLayout.cshtml";
    ViewData["Title"] = "Form Builder - " + Model.TemplateName;
    var progress = ViewData["Progress"] as FormBuilderProgressViewModel;
}

<!-- Form Builder CSS -->
<link href="~/css/form-builder/form-builder.css" rel="stylesheet" />

<!-- ============================================================================ -->
<!-- PROGRESS TRACKER - Same component used by all wizard steps -->
<!-- ============================================================================ -->
<partial name="~/Views/Shared/Components/FormBuilder/_FormBuilderProgress.cshtml" model="progress" />

<!-- ============================================================================ -->
<!-- TABBED NAVIGATION -->
<!-- ============================================================================ -->


<div class="builder-tabs-container">
    <div class="d-flex justify-content-between align-items-center w-100">

        <!-- Left side: Tabs -->
        <ul class="nav nav-tabs-custom rounded card-header-tabs border-bottom-0 mb-0" role="tablist">
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#builder-summary" role="tab">
                    <i class="ri-list-check-2"></i>
                    Summary
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#builder-design" role="tab">
                    <i class="ri-paint-brush-line"></i>
                    Design
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#builder-preview" role="tab">
                    <i class="ri-eye-line"></i>
                    Preview
                </a>
            </li>
        </ul>

        <!-- Right side: Action buttons -->
        <div class="d-flex align-items-center gap-2">
         <!-- Add Section button -->
            <button type="button"
                    class="btn btn-primary btn-sm"
                    onclick="addSection()">
                <i class="ri-add-line me-1"></i>
                Add Section
            </button>
            <!-- Back to Basic Info -->
            <a href="@Url.Action("Create", "FormTemplates", new { id = Model.TemplateId })"
               class="btn btn-soft-secondary btn-sm">
                <i class="ri-arrow-left-line me-1"></i>
                Back to Basic Info
            </a>

           

            <!-- Save Progress -->
            <button type="button" class="btn btn-soft-primary btn-sm" disabled>
                <i class="ri-save-line me-1"></i>
                Save Progress
            </button>

            <!-- Continue to Metrics -->
            <button type="button" class="btn btn-success btn-sm" disabled>
                Continue to Metrics
                <i class="ri-arrow-right-line ms-1"></i>
            </button>

            <!-- Properties toggle -->
            <div class="properties-toggle-btn ms-2"
                 onclick="toggleProperties()"
                 title="Toggle Properties Panel"
                 style="cursor: pointer;">
                <i class="ri-arrow-left-s-line" id="propertiesToggleIcon"></i>
            </div>
        </div>

    </div>
</div>


<!-- ============================================================================ -->
<!-- TAB CONTENT AREA -->
<!-- ============================================================================ -->
<div class="builder-content-area">
    <div class="tab-content text-muted">
        <!-- TAB 1: Summary -->
        <div class="tab-pane" id="builder-summary" role="tabpanel">
            <div class="p-4 text-center">
                <i class="ri-list-check-2 display-4 text-success"></i>
                <h5 class="mt-3">Summary Tab</h5>
                <p class="text-muted">Template: @Model.TemplateName</p>
                <p class="text-muted">Sections: @Model.Sections.Count</p>
                <p class="text-muted">Fields: @Model.TotalFields</p>
            </div>
        </div>
        
        <!-- TAB 2: Design -->
        <div class="tab-pane active" id="builder-design" role="tabpanel">
            <div class="design-grid" id="designGrid">
                <!-- LEFT: Toolbox -->
                <div class="design-toolbox">
                    <partial name="~/Views/Forms/FormTemplates/Partials/FormBuilder/_ToolboxPanel.cshtml" model="Model" />
                </div>
                
                <!-- CENTER: Canvas -->
                <div class="design-canvas">
                    <partial name="~/Views/Forms/FormTemplates/Partials/FormBuilder/_CanvasPanel.cshtml" model="Model" />
                </div>
                
                <!-- RIGHT: Properties (Collapsible) -->
                <div class="design-properties" id="propertiesPanel">
                    <partial name="~/Views/Forms/FormTemplates/Partials/FormBuilder/_PropertiesPanel.cshtml" model="Model" />
                </div>
            </div>
        </div>
        
        <!-- TAB 3: Preview -->
        <div class="tab-pane" id="builder-preview" role="tabpanel">
            <div class="p-4 text-center">
                <i class="ri-eye-line display-4 text-success"></i>
                <h5 class="mt-3">Preview Tab</h5>
                <p class="text-muted">See how your form looks</p>
            </div>
        </div>
    </div>
</div>

<!-- ============================================================================ -->
<!-- MODALS -->
<!-- ============================================================================ -->
<partial name="~/Views/Forms/FormTemplates/Partials/FormBuilder/Components/_Addsectionmodal.cshtml" />
<partial name="~/Views/Forms/FormTemplates/Partials/FormBuilder/Components/_DeleteSectionModal.cshtml" />
<partial name="~/Views/Forms/FormTemplates/Partials/FormBuilder/Components/_DuplicateSectionModal.cshtml" />

<!-- ============================================================================ -->
<!-- ALERT: Template Information -->
<!-- ============================================================================ -->


@section Scripts {
    <!-- SortableJS Library (already included in Velzon) -->
    <script src="~/assets/libs/sortablejs/Sortable.min.js"></script>

    <!-- Form Builder JavaScript Modules -->
    <script src="~/assets/js/pages/form-builder-layout.js"></script>
    <script src="~/assets/js/pages/form-builder-sections.js"></script>
    <script src="~/assets/js/pages/form-builder-dragdrop.js"></script>
    <script src="~/assets/js/pages/form-builder-properties.js"></script>
    <script src="~/assets/js/pages/form-builder.js"></script>

    <!-- Initialize with Template ID -->
    <script>
        // Set template ID for FormBuilder modules
        const TEMPLATE_ID = @Model.TemplateId;
    </script>
}
