@using FormReporting.Models.ViewModels.Components
@using FormReporting.Extensions

@*
    Wizard Step 2: Settings
    Contains: Template Type, Estimated Time, Approval, Workflows, Multiple Submissions, Active status
*@

<div class="row">
    <div class="col-md-6">
        <div class="mb-3">
            <label for="TemplateType" class="form-label">
                Template Type <span class="text-danger">*</span>
            </label>
            <select class="form-select" id="TemplateType" name="TemplateType" required>
                <option value="">Select type...</option>
                <option value="Monthly">Monthly</option>
                <option value="Quarterly">Quarterly</option>
                <option value="Annual">Annual</option>
                <option value="OnDemand">On Demand</option>
            </select>
            <div class="invalid-feedback">Please select a template type</div>
            <div class="form-text">How often should this form be submitted?</div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="mb-3">
            <label for="EstimatedCompletionTime" class="form-label">
                Estimated Completion Time (minutes)
            </label>
            <input type="number"
                   class="form-control"
                   id="EstimatedCompletionTime"
                   name="EstimatedCompletionTime"
                   placeholder="e.g., 15"
                   min="1">
            <div class="form-text">How long does it typically take to fill this form?</div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="mb-3">
            <div class="form-check form-switch">
                <input class="form-check-input"
                       type="checkbox"
                       id="RequiresApproval"
                       name="RequiresApproval">
                <label class="form-check-label" for="RequiresApproval">
                    Requires Approval
                </label>
            </div>
            <div class="form-text">Enable if submissions need to be approved</div>
        </div>
    </div>

   </div>

@* Approval Workflow Section (Collapsible) *@
<div id="approvalWorkflowSection" style="display: none;border-left: 2px solid #e9ebec;">
    <div class="card border-primary border-opacity-25 mt-3">
        <div class="card-body">
            @{
                var assignmentManager = ViewData["ApprovalWorkflowManager"] as FormReporting.Models.ViewModels.Components.AssignmentManagerViewModel;
                if (assignmentManager != null)
                {
                    <partial name="~/Views/Shared/Components/AssignmentManager/_AssignmentManager.cshtml" model="assignmentManager" />
                }
                else
                {
                    // Fallback if no ViewData provided
                    var defaultConfig = new FormReporting.Models.ViewModels.Components.AssignmentManagerConfig
                    {
                        ManagerId = "template-approval-workflow",
                        ContextLabel = "Approval Levels",
                        HelpText = "Define who needs to approve submissions for this form template",
                        ShowLevels = true,
                        AllowMultiplePerLevel = false,
                        IsCollapsible = false
                    }
                    .WithAssignmentType("User", "Specific User", "ri-user-line", isDefault: true)
                    .WithAssignmentType("Role", "By Role", "ri-shield-user-line")
                    .BuildAssignmentManager();

                    <partial name="~/Views/Shared/Components/AssignmentManager/_AssignmentManager.cshtml" model="defaultConfig" />
                }
            }
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="mb-3">
            <div class="form-check form-switch">
                <input class="form-check-input"
                       type="checkbox"
                       id="AllowMultipleSubmissions"
                       name="AllowMultipleSubmissions"
                       checked>
                <label class="form-check-label" for="AllowMultipleSubmissions">
                    Allow Multiple Submissions
                </label>
            </div>
            <div class="form-text">Allow users to submit this form multiple times</div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="mb-3">
            <div class="form-check form-switch">
                <input class="form-check-input"
                       type="checkbox"
                       id="IsActive"
                       name="IsActive"
                       checked>
                <label class="form-check-label" for="IsActive">
                    Active
                </label>
            </div>
            <div class="form-text">Template will be active and usable</div>
        </div>
    </div>
</div>

@* JavaScript moved to Create.cshtml @section Scripts to ensure jQuery is loaded *@
