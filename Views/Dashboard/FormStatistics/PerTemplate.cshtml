@using FormReporting.Models.ViewModels.Dashboard.Components.Composite
@model DashboardConfig

@{
    ViewData["Title"] = Model.Title ?? "Form Submission Statistics";
}

@* Render unified dashboard component *@
@await Html.PartialAsync("~/Views/Shared/Components/Dashboard/Composite/_Dashboard.cshtml", Model)

@* Inline JavaScript initialization (works in both full page and partial contexts) *@
<script>
    (function() {
        // Wait for jQuery and FormStatisticsDashboard to be available
        function initDashboard() {
            if (typeof $ === 'undefined' || typeof FormStatisticsDashboard === 'undefined') {
                setTimeout(initDashboard, 100);
                return;
            }
            
            $(document).ready(function() {
                // Initialize dashboard based on loading strategy
                @if (Model.LoadingStrategy == LoadingStrategy.Progressive)
                {
                    <text>
                    // Progressive loading - AJAX load sections
                    FormStatisticsDashboard.init({
                        templateId: @(ViewBag.TemplateId ?? Model.Id.Replace("form-stats-", "")),
                        startDate: '@ViewBag.StartDate',
                        endDate: '@ViewBag.EndDate',
                        tenantId: @(ViewBag.TenantId ?? "null"),
                        groupBy: '@(ViewBag.GroupBy ?? "Daily")'
                    });
                    </text>
                }
                else
                {
                    <text>
                    // Server-side rendering - just initialize filter handlers
                    FormStatisticsDashboard.init({
                        templateId: @(ViewBag.TemplateId ?? Model.Id.Replace("form-stats-", "")),
                        startDate: '@ViewBag.StartDate',
                        endDate: '@ViewBag.EndDate',
                        tenantId: @(ViewBag.TenantId ?? "null"),
                        groupBy: '@(ViewBag.GroupBy ?? "Daily")'
                    });
                    </text>
                }
            });
        }
        
        initDashboard();
    })();
</script>
